var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function c(e){return"function"==typeof e}function s(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function r(t,n,o){t.$$.on_destroy.push(function(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}(n,o))}function u(e,t,n,o){if(e){const c=l(e,t,n,o);return e[0](c)}}function l(e,t,n,o){return e[1]&&o?function(e,t){for(const n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](o(t))):n.ctx}function i(e,t,n,o){if(e[2]&&o){const c=e[2](o(n));if(void 0===t.dirty)return c;if("object"==typeof c){const e=[],n=Math.max(t.dirty.length,c.length);for(let o=0;o<n;o+=1)e[o]=t.dirty[o]|c[o];return e}return t.dirty|c}return t.dirty}function a(e,t,n,o,c,s){if(c){const r=l(t,n,o,s);e.p(r,c)}}function d(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let e=0;e<n;e++)t[e]=-1;return t}return-1}function f(e,t){e.appendChild(t)}function p(e,t,n){e.insertBefore(t,n||null)}function h(e){e.parentNode.removeChild(e)}function m(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function $(e){return document.createElement(e)}function g(e){return document.createTextNode(e)}function v(){return g(" ")}function y(){return g("")}function b(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function _(e){return function(t){return t.preventDefault(),e.call(this,t)}}function k(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function x(e,t,n,o){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}function w(e,t,n){e.classList[n?"add":"remove"](t)}let E;function I(e){E=e}function N(){if(!E)throw new Error("Function called outside component initialization");return E}function C(){const e=N();return(t,n)=>{const o=e.$$.callbacks[t];if(o){const c=function(e,t,n=!1){const o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n,!1,t),o}(t,n);o.slice().forEach((t=>{t.call(e,c)}))}}}const M=[],O=[],P=[],D=[],S=Promise.resolve();let A=!1;function W(e){P.push(e)}const T=new Set;let j=0;function z(){const e=E;do{for(;j<M.length;){const e=M[j];j++,I(e),L(e.$$)}for(I(null),M.length=0,j=0;O.length;)O.pop()();for(let e=0;e<P.length;e+=1){const t=P[e];T.has(t)||(T.add(t),t())}P.length=0}while(M.length);for(;D.length;)D.pop()();A=!1,T.clear(),I(e)}function L(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(W)}}const R=new Set;let q;function B(){q={r:0,c:[],p:q}}function F(){q.r||o(q.c),q=q.p}function K(e,t){e&&e.i&&(R.delete(e),e.i(t))}function G(e,t,n,o){if(e&&e.o){if(R.has(e))return;R.add(e),q.c.push((()=>{R.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}}function H(e){e&&e.c()}function U(e,n,s,r){const{fragment:u,on_mount:l,on_destroy:i,after_update:a}=e.$$;u&&u.m(n,s),r||W((()=>{const n=l.map(t).filter(c);i?i.push(...n):o(n),e.$$.on_mount=[]})),a.forEach(W)}function V(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function J(e,t){-1===e.$$.dirty[0]&&(M.push(e),A||(A=!0,S.then(z)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Q(t,c,s,r,u,l,i,a=[-1]){const d=E;I(t);const f=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(d?d.$$.context:[])),callbacks:n(),dirty:a,skip_bound:!1,root:c.target||d.$$.root};i&&i(f.root);let p=!1;if(f.ctx=s?s(t,c.props||{},((e,n,...o)=>{const c=o.length?o[0]:n;return f.ctx&&u(f.ctx[e],f.ctx[e]=c)&&(!f.skip_bound&&f.bound[e]&&f.bound[e](c),p&&J(t,e)),n})):[],f.update(),p=!0,o(f.before_update),f.fragment=!!r&&r(f.ctx),c.target){if(c.hydrate){const e=function(e){return Array.from(e.childNodes)}(c.target);f.fragment&&f.fragment.l(e),e.forEach(h)}else f.fragment&&f.fragment.c();c.intro&&K(t.$$.fragment),U(t,c.target,c.anchor,c.customElement),z()}I(d)}class X{$destroy(){V(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}function Y(t){let n,c,s;return{c(){n=$("div"),x(n,"--width",t[1]-.47*t[1]*!t[5]+"px"),x(n,"transform","translate("+t[4]+"px)"),k(n,"draggable","false"),k(n,"class","svelte-cuiora"),w(n,"accidental",!t[5]),w(n,"natural",t[5]),w(n,"pressed",t[0])},m(e,o){p(e,n,o),c||(s=[b(n,"mousedown",_(t[2])),b(n,"mouseup",_(t[3])),b(n,"mouseenter",t[7]),b(n,"mouseleave",t[8]),b(n,"touchstart",_(t[2])),b(n,"touchend",_(t[3]))],c=!0)},p(e,[t]){2&t&&x(n,"--width",e[1]-.47*e[1]*!e[5]+"px"),16&t&&x(n,"transform","translate("+e[4]+"px)"),1&t&&w(n,"pressed",e[0])},i:e,o:e,d(e){e&&h(n),c=!1,o(s)}}}function Z(e,t,n){let{noteNum:o}=t,{keyWidth:c=56}=t,{pressed:s=!1}=t;const r=C();let u=![1,3,6,8,10].includes(o%12),l=0;function i(e){s||(r("noteon",o),n(0,s=!0))}function a(e){s&&(r("noteoff",o),n(0,s=!1))}u||([1,6].includes(o%12)?l=-c/12:[3,10].includes(o%12)&&(l=c/12));return e.$$set=e=>{"noteNum"in e&&n(6,o=e.noteNum),"keyWidth"in e&&n(1,c=e.keyWidth),"pressed"in e&&n(0,s=e.pressed)},[s,c,i,a,l,u,o,e=>{e.buttons&&i()},e=>{e.buttons&&a()}]}class ee extends X{constructor(e){super(),Q(this,e,Z,Y,s,{noteNum:6,keyWidth:1,pressed:0,keyPressed:2,keyReleased:3})}get keyPressed(){return this.$$.ctx[2]}get keyReleased(){return this.$$.ctx[3]}}function te(e,t,n){const o=e.slice();return o[17]=t[n],o}function ne(e,t,n){const o=e.slice();return o[20]=t[n],o[21]=t,o[22]=n,o}function oe(e){let t,n,o=e[20];const c=()=>e[13](t,o),s=()=>e[13](null,o);let r={noteNum:e[20],keyWidth:e[6],pressed:e[0].includes(e[20])};return t=new ee({props:r}),c(),t.$on("noteon",e[14]),t.$on("noteoff",e[15]),{c(){H(t.$$.fragment)},m(e,o){U(t,e,o),n=!0},p(e,n){o!==e[20]&&(s(),o=e[20],c());const r={};8&n&&(r.noteNum=e[20]),64&n&&(r.keyWidth=e[6]),9&n&&(r.pressed=e[0].includes(e[20])),t.$set(r)},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){s(),V(t,e)}}}function ce(e){let t,n=e[4],o=[];for(let t=0;t<n.length;t+=1)o[t]=se(te(e,n,t));return{c(){for(let e=0;e<o.length;e+=1)o[e].c();t=y()},m(e,n){for(let t=0;t<o.length;t+=1)o[t].m(e,n);p(e,t,n)},p(e,c){if(16&c){let s;for(n=e[4],s=0;s<n.length;s+=1){const r=te(e,n,s);o[s]?o[s].p(r,c):(o[s]=se(r),o[s].c(),o[s].m(t.parentNode,t))}for(;s<o.length;s+=1)o[s].d(1);o.length=n.length}},d(e){m(o,e),e&&h(t)}}}function se(e){let t,n,o=e[17]+"";return{c(){t=$("div"),n=g(o)},m(e,o){p(e,t,o),f(t,n)},p(e,t){16&t&&o!==(o=e[17]+"")&&function(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}(n,o)},d(e){e&&h(t)}}}function re(e){let t,n,o,c,s,r,u;W(e[12]);let l=e[3],i=[];for(let t=0;t<l.length;t+=1)i[t]=oe(ne(e,l,t));const a=e=>G(i[e],1,1,(()=>{i[e]=null}));let d=e[1]&&ce(e);return{c(){t=$("div"),n=$("div");for(let e=0;e<i.length;e+=1)i[e].c();o=v(),d&&d.c(),c=y(),k(n,"class","svelte-e1a7d6"),k(t,"class","keyboard svelte-e1a7d6")},m(l,a){p(l,t,a),f(t,n);for(let e=0;e<i.length;e+=1)i[e].m(n,null);p(l,o,a),d&&d.m(l,a),p(l,c,a),s=!0,r||(u=b(window,"resize",e[12]),r=!0)},p(e,[t]){if(1001&t){let o;for(l=e[3],o=0;o<l.length;o+=1){const c=ne(e,l,o);i[o]?(i[o].p(c,t),K(i[o],1)):(i[o]=oe(c),i[o].c(),K(i[o],1),i[o].m(n,null))}for(B(),o=l.length;o<i.length;o+=1)a(o);F()}e[1]?d?d.p(e,t):(d=ce(e),d.c(),d.m(c.parentNode,c)):d&&(d.d(1),d=null)},i(e){if(!s){for(let e=0;e<l.length;e+=1)K(i[e]);s=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)G(i[e]);s=!1},d(e){e&&h(t),m(i,e),e&&h(o),d&&d.d(e),e&&h(c),r=!1,u()}}}function ue(e,t,n){let o,{octaves:c=2}=t,{middleC:s=60}=t,{keysPressed:r=[]}=t,{verbose:u}=t;const l=12*c;let i,a=[];function d(e,t=127){n(4,a=[`Note ${e} was pressed!`,...a]),MIDI.noteOn(0,e,t,0)}function f(e){n(4,a=[`Note ${e} was released!`,...a]),MIDI.noteOff(0,e,0)}function p(e){var t,n,o;if(u){let t="MIDI message received at timestamp "+e.timeStamp+"["+e.data.length+" bytes]: ";for(let n=0;n<e.data.length;n++)t+="0x"+e.data[n].toString(16)+" ",e.data;console.log(t)}const c=e.data[0],s=e.data[1]%l,r=e.data.length>2?e.data[2]:0;switch(c){case 144:r>0?null===(t=$[s])||void 0===t||t.keyPressed(s):null===(n=$[s])||void 0===n||n.keyReleased(s);break;case 128:null===(o=$[s])||void 0===o||o.keyReleased(s)}}var h;h=async()=>{MIDI.loadPlugin({soundfontUrl:"./soundfont/",instrument:"acoustic_grand_piano",onprogress(e,t){console.log(e,t)},onsuccess(){MIDI.setVolume(0,127)}});try{let e=await navigator.requestMIDIAccess();console.log("MIDI ready!"),u&&function(e){for(const t of e.inputs){const e=t[1];console.log("Input port [type:'"+e.type+"'] id:'"+e.id+"' manufacturer:'"+e.manufacturer+"' name:'"+e.name+"' version:'"+e.version+"'")}for(const t of e.outputs){const e=t[1];console.log("Output port [type:'"+e.type+"'] id:'"+e.id+"' manufacturer:'"+e.manufacturer+"' name:'"+e.name+"' version:'"+e.version+"'")}}(e),e.inputs.forEach((e=>{e.onmidimessage=p}))}catch(e){console.log("Failed to get MIDI access - "+e)}},N().$$.on_mount.push(h);let m,$={};return e.$$set=e=>{"octaves"in e&&n(10,c=e.octaves),"middleC"in e&&n(11,s=e.middleC),"keysPressed"in e&&n(0,r=e.keysPressed),"verbose"in e&&n(1,u=e.verbose)},e.$$.update=()=>{3072&e.$$.dirty&&n(3,i=[...Array(12*c+1).keys()].map((e=>e+(s-12*Math.floor(c/2))))),1028&e.$$.dirty&&n(6,o=Math.min((m-36/c)/(8*c),56))},[r,u,m,i,a,$,o,l,d,f,c,s,function(){n(2,m=window.innerWidth)},function(e,t){O[e?"unshift":"push"]((()=>{$[t%l]=e,n(5,$)}))},({detail:e})=>d(e),({detail:e})=>f(e)]}class le extends X{constructor(e){super(),Q(this,e,ue,re,s,{octaves:10,middleC:11,keysPressed:0,verbose:1})}}const ie=e=>({}),ae=e=>({});function de(e){let t,n,c,s,r,l,m,g,y;const _=e[4].header,x=u(_,e,e[3],ae),w=e[4].default,E=u(w,e,e[3],null);return{c(){t=$("div"),n=v(),c=$("div"),x&&x.c(),s=v(),E&&E.c(),r=v(),l=$("button"),l.textContent="Close",k(t,"class","modal-background svelte-1v9i8a4"),l.autofocus=!0,k(l,"class","svelte-1v9i8a4"),k(c,"class","modal svelte-1v9i8a4"),k(c,"role","dialog"),k(c,"aria-modal","true")},m(o,u){p(o,t,u),p(o,n,u),p(o,c,u),x&&x.m(c,null),f(c,s),E&&E.m(c,null),f(c,r),f(c,l),e[5](c),m=!0,l.focus(),g||(y=[b(window,"keydown",e[2]),b(t,"click",e[1]),b(l,"click",e[1])],g=!0)},p(e,[t]){x&&x.p&&(!m||8&t)&&a(x,_,e,e[3],m?i(_,e[3],t,ie):d(e[3]),ae),E&&E.p&&(!m||8&t)&&a(E,w,e,e[3],m?i(w,e[3],t,null):d(e[3]),null)},i(e){m||(K(x,e),K(E,e),m=!0)},o(e){G(x,e),G(E,e),m=!1},d(s){s&&h(t),s&&h(n),s&&h(c),x&&x.d(s),E&&E.d(s),e[5](null),g=!1,o(y)}}}function fe(e,t,n){let{$$slots:o={},$$scope:c}=t;const s=C(),r=()=>s("close");let u;const l="undefined"!=typeof document&&document.activeElement;var i;return l&&(i=()=>{l.focus()},N().$$.on_destroy.push(i)),e.$$set=e=>{"$$scope"in e&&n(3,c=e.$$scope)},[u,r,e=>{if("Escape"!==e.key){if("Tab"===e.key){const t=u.querySelectorAll("*"),n=Array.from(t).filter((e=>e.tabIndex>=0));let o=n.indexOf(document.activeElement);-1===o&&e.shiftKey&&(o=0),o+=n.length+(e.shiftKey?-1:1),o%=n.length,n[o].focus(),e.preventDefault()}}else r()},c,o,function(e){O[e?"unshift":"push"]((()=>{u=e,n(0,u)}))}]}class pe extends X{constructor(e){super(),Q(this,e,fe,de,s,{})}}const he=[];function me(t,n=e){let o;const c=new Set;function r(e){if(s(t,e)&&(t=e,o)){const e=!he.length;for(const e of c)e[1](),he.push(e,t);if(e){for(let e=0;e<he.length;e+=2)he[e][0](he[e+1]);he.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(s,u=e){const l=[s,u];return c.add(l),1===c.size&&(o=n(r)||e),s(t),()=>{c.delete(l),0===c.size&&(o(),o=null)}}}}const $e=me(1),ge=me(!1),ve=e=>({}),ye=e=>({});function be(e){let t,n;return t=new pe({props:{$$slots:{default:[_e]},$$scope:{ctx:e}}}),t.$on("close",e[10]),{c(){H(t.$$.fragment)},m(e,o){U(t,e,o),n=!0},p(e,n){const o={};2054&n&&(o.$$scope={dirty:n,ctx:e}),t.$set(o)},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){V(t,e)}}}function _e(t){let n,c,s,r,l,m,y,_,x,w,E,I,N,C,M,O,P,D,S,A,W,T,j;const z=t[3].header,L=u(z,t,t[11],ye),R=L||function(t){let n;return{c(){n=$("h1"),n.textContent="Settings"},m(e,t){p(e,n,t)},p:e,d(e){e&&h(n)}}}();return{c(){R&&R.c(),n=v(),c=$("h2"),c.textContent="Octaves",s=v(),r=$("label"),l=$("input"),m=g("\n      One"),y=v(),_=$("label"),x=$("input"),w=g("\n      Two"),E=v(),I=$("label"),N=$("input"),C=g("\n      Three"),M=v(),O=$("h2"),O.textContent="Debug",P=v(),D=$("label"),S=g("Enable logging:\n      "),A=$("input"),k(l,"type","radio"),k(l,"name","octaves"),l.__value=1,l.value=l.__value,t[6][0].push(l),k(x,"type","radio"),k(x,"name","octaves"),x.__value=2,x.value=x.__value,t[6][0].push(x),k(N,"type","radio"),k(N,"name","octaves"),N.__value=3,N.value=N.__value,t[6][0].push(N),k(A,"type","checkbox")},m(e,o){R&&R.m(e,o),p(e,n,o),p(e,c,o),p(e,s,o),p(e,r,o),f(r,l),l.checked=l.__value===t[1],f(r,m),p(e,y,o),p(e,_,o),f(_,x),x.checked=x.__value===t[1],f(_,w),p(e,E,o),p(e,I,o),f(I,N),N.checked=N.__value===t[1],f(I,C),p(e,M,o),p(e,O,o),p(e,P,o),p(e,D,o),f(D,S),f(D,A),A.checked=t[2],W=!0,T||(j=[b(l,"change",t[5]),b(x,"change",t[7]),b(N,"change",t[8]),b(A,"change",t[9])],T=!0)},p(e,t){L&&L.p&&(!W||2048&t)&&a(L,z,e,e[11],W?i(z,e[11],t,ve):d(e[11]),ye),2&t&&(l.checked=l.__value===e[1]),2&t&&(x.checked=x.__value===e[1]),2&t&&(N.checked=N.__value===e[1]),4&t&&(A.checked=e[2])},i(e){W||(K(R,e),W=!0)},o(e){G(R,e),W=!1},d(e){R&&R.d(e),e&&h(n),e&&h(c),e&&h(s),e&&h(r),t[6][0].splice(t[6][0].indexOf(l),1),e&&h(y),e&&h(_),t[6][0].splice(t[6][0].indexOf(x),1),e&&h(E),e&&h(I),t[6][0].splice(t[6][0].indexOf(N),1),e&&h(M),e&&h(O),e&&h(P),e&&h(D),T=!1,o(j)}}}function ke(e){let t,n,o,c,s,r,u=e[0]&&be(e);return{c(){t=$("button"),t.textContent="⚙️ Settings",n=v(),u&&u.c(),o=y(),k(t,"display","inline-block;")},m(l,i){p(l,t,i),p(l,n,i),u&&u.m(l,i),p(l,o,i),c=!0,s||(r=b(t,"click",e[4]),s=!0)},p(e,[t]){e[0]?u?(u.p(e,t),1&t&&K(u,1)):(u=be(e),u.c(),K(u,1),u.m(o.parentNode,o)):u&&(B(),G(u,1,1,(()=>{u=null})),F())},i(e){c||(K(u),c=!0)},o(e){G(u),c=!1},d(e){e&&h(t),e&&h(n),u&&u.d(e),e&&h(o),s=!1,r()}}}function xe(e,t,n){let o,c;r(e,$e,(e=>n(1,o=e))),r(e,ge,(e=>n(2,c=e)));let{$$slots:s={},$$scope:u}=t,l=!1;return e.$$set=e=>{"$$scope"in e&&n(11,u=e.$$scope)},[l,o,c,s,()=>n(0,l=!0),function(){o=this.__value,$e.set(o)},[[]],function(){o=this.__value,$e.set(o)},function(){o=this.__value,$e.set(o)},function(){c=this.checked,ge.set(c)},()=>n(0,l=!1),u]}class we extends X{constructor(e){super(),Q(this,e,xe,ke,s,{})}}function Ee(e){let t,n;return t=new le({props:{octaves:e[0],verbose:e[1]}}),{c(){H(t.$$.fragment)},m(e,o){U(t,e,o),n=!0},p(e,n){const o={};1&n&&(o.octaves=e[0]),2&n&&(o.verbose=e[1]),t.$set(o)},i(e){n||(K(t.$$.fragment,e),n=!0)},o(e){G(t.$$.fragment,e),n=!1},d(e){V(t,e)}}}function Ie(t){let n,o,c,r,u,l,i,a,d=t[0];u=new we({});let m=Ee(t);return{c(){n=v(),o=$("div"),c=$("h1"),c.innerHTML='<a href="https://github.com/lukemcneil/ear-game">Ear Game</a>',r=v(),H(u.$$.fragment),l=v(),m.c(),i=y(),document.title="Svelte Piano",k(o,"class","nav svelte-4cokm4")},m(e,t){p(e,n,t),p(e,o,t),f(o,c),f(o,r),U(u,o,null),p(e,l,t),m.m(e,t),p(e,i,t),a=!0},p(t,[n]){1&n&&s(d,d=t[0])?(B(),G(m,1,1,e),F(),m=Ee(t),m.c(),K(m),m.m(i.parentNode,i)):m.p(t,n)},i(e){a||(K(u.$$.fragment,e),K(m),a=!0)},o(e){G(u.$$.fragment,e),G(m),a=!1},d(e){e&&h(n),e&&h(o),V(u),e&&h(l),e&&h(i),m.d(e)}}}function Ne(e,t,n){let o,c;return r(e,$e,(e=>n(0,o=e))),r(e,ge,(e=>n(1,c=e))),[o,c]}return new class extends X{constructor(e){super(),Q(this,e,Ne,Ie,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
